# Mathematical Formulas Documentation

## Overview

This document provides comprehensive documentation of the mathematical formulas used in the PQTorus project for visualizing elliptic curve tori. The torus is defined as the quotient ℂ/L where L is a lattice generated by two prime periods p and q.

## Lattice Definition

### Basic Lattice
The fundamental lattice L is defined as:
```
L = {n₁ω₁ + n₂ω₂ | n₁, n₂ ∈ ℤ}
```

**Current Implementation:**
- Period 1: `ω₁ = p + 0i` (real period)
- Period 2: `ω₂ = 0 + qi` (purely imaginary period)
- Lattice: `L = {n₁p + n₂qi | n₁, n₂ ∈ ℤ}`

### Degree-d Approximation Lattice
For visualization purposes, a sub-lattice with degree d ≥ 0 is used:
```
L_d = {n₁ω₁/2^d + n₂ω₂/2^d | n₁, n₂ ∈ ℤ}
```

**Formula in terms of p and q:**
```
L_d = {n₁(p/2^d) + n₂(qi/2^d) | n₁, n₂ ∈ ℤ}
    = {(n₁p + n₂qi)/2^d | n₁, n₂ ∈ ℤ}
```

**Current Implementation:**
- Scale factor: `scale = 1/2^d = 2^(-d)`
- Lattice points generated for visualization range: n₁, n₂ ∈ [-10, 10]

## Elliptic Curve Invariants

### Tau (τ) - Lattice Ratio
The complex ratio τ defines the shape of the lattice:
```
τ = ω₂/ω₁
```

**Formula in terms of p and q:**
```
τ = (0 + qi)/(p + 0i) = qi/p = i(q/p)
```

**Current Implementation:**
```typescript
// TypeScript
const tau = period2.divide(period1)  // (0 + qi) / (p + 0i)

// Kotlin  
val tau = period2 / period1  // Complex division
```

### J-Invariant
The j-invariant is a fundamental elliptic curve invariant that determines the isomorphism class of the elliptic curve.

**Mathematical Formula:**
For a lattice with periods ω₁, ω₂, the j-invariant is:
```
j(τ) = 1728 * g₂³/(g₂³ - 27g₃²)
```

Where the Eisenstein series are:
```
g₂(τ) = 60 ∑'_{(m,n)≠(0,0)} 1/(mω₁ + nω₂)⁴
g₃(τ) = 140 ∑'_{(m,n)≠(0,0)} 1/(mω₁ + nω₂)⁶
```

**Current Implementation:**
```typescript
// Simplified placeholder - does not use actual elliptic function theory
const jInvariant = new Complex(1728, 0)  // Constant placeholder
```

**Note:** The current implementation uses a placeholder value. A proper implementation would:
1. Calculate the Eisenstein series g₂ and g₃
2. Compute j(τ) = 1728g₂³/(g₂³ - 27g₃²)
3. For our case with τ = i(q/p), this would be j(i(q/p))

### Discriminant
The discriminant Δ determines whether the lattice defines a valid elliptic curve.

**Mathematical Formula:**
```
Δ(τ) = g₂³ - 27g₃² = (2πi)¹²η(τ)²⁴
```

Where η(τ) is the Dedekind eta function.

**Alternative Formula (Lattice Discriminant):**
```
Δ = (ω₁ω̄₂ - ω̄₁ω₂)/(2i) = Im(ω̄₁ω₂)
```

**Current Implementation:**
```typescript
// Simplified as product of periods  
const discriminant = period1.multiply(period2)  // p * qi = pqi
```

**Formula in terms of p and q:**
```
Current: Δ = p * qi = pqi
Proper:  Δ = Im(p̄ * qi) = Im(p * qi) = pq
```

## Torus Projection Formulas

### Current Geometric Torus Parametrization
The current implementation projects lattice points to a standard geometric torus:

**Parametric Equations:**
```
x(u,v) = (R + r*cos(v)) * cos(u)
y(u,v) = (R + r*cos(v)) * sin(u)  
z(u,v) = r * sin(v)
```

Where:
- `R = 2.0` (major radius)
- `r = 0.5` (minor radius)  
- `u, v ∈ [0, 2π]` (parametric coordinates)

**Current Implementation:**
```typescript
const u = 2 * Math.PI * i / meshDensity
const v = 2 * Math.PI * j / meshDensity

const x = (majorRadius + minorRadius * Math.cos(v)) * Math.cos(u)
const y = (majorRadius + minorRadius * Math.cos(v)) * Math.sin(u)
const z = minorRadius * Math.sin(v)
```

### Proper Elliptic Curve Torus Projection
**Note:** The current implementation uses a standard geometric torus and does not actually project the complex lattice points to create an elliptic curve torus. A proper implementation would:

1. Map lattice points z ∈ ℂ/L to the torus surface
2. Use the Weierstrass ℘-function and its derivative
3. Project via: (℘(z), ℘'(z)) → 3D coordinates

**Mathematical Foundation:**
For a lattice point z ∈ ℂ, the elliptic curve point is:
```
(X, Y) = (℘(z; ω₁, ω₂), ℘'(z; ω₁, ω₂))
```

Where ℘ is the Weierstrass elliptic function satisfying:
```
℘'²(z) = 4℘³(z) - g₂℘(z) - g₃
```

## Summary of Current vs. Proper Formulas

| Component | Current Implementation | Proper Mathematical Formula |
|-----------|----------------------|----------------------------|
| **Lattice** | L = {n₁p + n₂qi \| n₁,n₂ ∈ ℤ} | ✓ Correct |
| **Tau** | τ = qi/p = i(q/p) | ✓ Correct |
| **J-Invariant** | j = 1728 (placeholder) | j(τ) = 1728g₂³/(g₂³-27g₃²) |
| **Discriminant** | Δ = pqi | Δ = Im(ω̄₁ω₂) = pq |
| **Projection** | Standard geometric torus | Elliptic curve via ℘-function |

## Implementation Notes

1. **Degree Scaling**: The factor `2^(-d)` scales the lattice for finer/coarser approximations
2. **Visualization Range**: Points generated for n₁, n₂ ∈ [-10, 10] for practical visualization
3. **Mesh Density**: Controls the resolution of the torus surface (default: 20×20 grid)
4. **Prime Periods**: p and q should be prime numbers for mathematical correctness

## References

- Silverman, J.H. "The Arithmetic of Elliptic Curves"
- Chandrasekharan, K. "Elliptic Functions" 
- Apostol, T.M. "Modular Functions and Dirichlet Series"